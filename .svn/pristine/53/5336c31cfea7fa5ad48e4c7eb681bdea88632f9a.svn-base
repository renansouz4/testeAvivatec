package Spreadsheet;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.DataFormatter;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.xssf.usermodel.XSSFSheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import ConstantsFramework.Constants_Framework;
import ConstantsSuiteTests.ConstantsSpreadsheet;
import jxl.read.biff.BiffException;

public class Spreadsheet {

	@SuppressWarnings({ "null", })
	public static Object[] getArraySpreadsheetPlan(final String planilha) {

		List<Object[]> array = new ArrayList<Object[]>();
		List<Object> aux = new ArrayList<Object>();

		FileInputStream arquivo = null;
		try {
			arquivo = new FileInputStream(new File(planilha));
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		XSSFWorkbook workbook = null;
		try {
			workbook = new XSSFWorkbook(arquivo);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		XSSFSheet sheetAlunos = workbook.getSheetAt(0);

		int totalColunas = sheetAlunos.getRow(0).getPhysicalNumberOfCells() + 1;
		int totalLinha = sheetAlunos.getPhysicalNumberOfRows();

		System.out.println("linha " + totalLinha + " coluna  " + totalColunas);
		int cont = 1;
		for (int ii = 1; ii < totalColunas; ii++) {
			Iterator<Row> rowIterator = sheetAlunos.iterator();
			Row row = rowIterator.next();
			Row row1 = rowIterator.next();
			Cell celulaAtual = row1.getCell(cont);
			System.out.println("STATUS :" + celulaAtual.getStringCellValue());

			if (celulaAtual.getStringCellValue().equals("CARREGAR")) {

				Cell valorcelula;
				aux = new ArrayList<Object>();
				int cont1 = 0;
				for (int i = 2; i < totalLinha; i++) {
					Row row2 = rowIterator.next();

					java.util.Iterator<org.apache.poi.ss.usermodel.Cell> cellIterator = row2.cellIterator();

					Cell cenariosPlanilha = row2.getCell(0);
					aux.add(row2.getCell(cont).getStringCellValue());

					System.out.println("ARRAY : " + aux.get(cont1));
					cont1++;
				}
				array.add(aux.toArray());

			}

			cont++;

		}

		try {
			arquivo.close();
			workbook.close();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		return array.toArray();
	}

	@SuppressWarnings({ "null", })
	public static Object[] getStringSpreadsheetAmbiente() {

		List<Object[]> array = new ArrayList<Object[]>();
		List<Object> aux = new ArrayList<Object>();

		FileInputStream arquivo = null;
		try {
			arquivo = new FileInputStream(new File(ConstantsSpreadsheet.EXCEL_AMBIENTE));
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		XSSFWorkbook workbook = null;
		try {
			workbook = new XSSFWorkbook(arquivo);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		XSSFSheet sheetAlunos = workbook.getSheetAt(0);

		int totalColunas = sheetAlunos.getRow(0).getPhysicalNumberOfCells();
		int totalLinha = sheetAlunos.getPhysicalNumberOfRows() - 2;

		System.out.println("linha " + totalLinha + " coluna  " + totalColunas);
		int cont = 1;
		for (int ii = 1; ii < totalColunas; ii++) {
			Iterator<Row> rowIterator = sheetAlunos.iterator();
			Row row = rowIterator.next();
			Row row1 = rowIterator.next();
			Cell celulaAtual = row1.getCell(cont);
			System.out.println("AMBIENTE_USE :" + celulaAtual.getStringCellValue());

			if (celulaAtual.getStringCellValue().equals("SIM")) {

				aux = new ArrayList<Object>();
				Cell valorcelula;
				int cont1 = 0;
				for (int i = 2; i < totalLinha; i++) {
					Row row2 = rowIterator.next();

					java.util.Iterator<org.apache.poi.ss.usermodel.Cell> cellIterator = row2.cellIterator();

					Cell cenariosPlanilha = row2.getCell(0);

					System.out.println("AMBIENTE : " + row2.getCell(cont).getStringCellValue());
					aux.add(row2.getCell(cont).getStringCellValue());
					cont1++;
				}
				array.add(aux.toArray());

			}

			cont++;

		}

		try {
			arquivo.close();
			workbook.close();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		return aux.toArray();
	}

	@SuppressWarnings({ "null", })
	public static Object[] getStringSpreadsheetPromocoes() {

		List<Object[]> array = new ArrayList<Object[]>();
		List<Object> aux = new ArrayList<Object>();

		FileInputStream arquivo = null;
		try {
			arquivo = new FileInputStream(new File(ConstantsSpreadsheet.EXCEL_PROMOCOES));
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		XSSFWorkbook workbook = null;
		try {
			workbook = new XSSFWorkbook(arquivo);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		DataFormatter dataFormatter = new DataFormatter();
		XSSFSheet sheetAlunos = workbook.getSheetAt(0);

		int totalColunas = sheetAlunos.getRow(0).getPhysicalNumberOfCells();
		int totalLinha = sheetAlunos.getPhysicalNumberOfRows();

		Iterator<Row> rowIterator = sheetAlunos.iterator();
		Row row0 = rowIterator.next();
		int ii = 1;
		
		while (rowIterator.hasNext()) {
			
			Row row = rowIterator.next();

			String LINHA = dataFormatter.formatCellValue(row.getCell(ii));
			System.out.println("linha : " + LINHA);
			

			if (LINHA.equals("CARREGAR")) {
				Iterator<Cell> cellIterator = row.cellIterator();

				while (cellIterator.hasNext()) {
					Cell cell = cellIterator.next();
					String cellValue = dataFormatter.formatCellValue(cell);
					System.out.print(cellValue + "\t");
				}
				
				System.out.println();

			}
			
		}

		try {
			arquivo.close();
			workbook.close();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		return aux.toArray();
	}

	
	public void atualizarPlanilha(String planilha, String TesteCaseId, String statusTest) {
		FileInputStream arquivo = null;
		try {
			arquivo = new FileInputStream(new File(planilha));
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		HSSFWorkbook workbook = null;
		try {
			workbook = new HSSFWorkbook(arquivo);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		HSSFSheet sheetAlunos = workbook.getSheetAt(0);
		
	
		
		int totallinhas = 1;
		int totalcolunas = sheetAlunos.getRow(0).getPhysicalNumberOfCells();
		
	    System.out.println("linha "+totallinhas+" coluna  "+totalcolunas);

		java.util.Iterator<Row> rowIterator = sheetAlunos.iterator();

		while (rowIterator.hasNext()) {

			Row row = rowIterator.next();
			for (int ii = 0; ii < totallinhas; ii++) {

				int status = ii;
				org.apache.poi.ss.usermodel.Cell celulaAtualCT= row.getCell(ii);
				Row row2 = rowIterator.next();
				status = status+1;
				org.apache.poi.ss.usermodel.Cell celulaAtualSTATUS= row2.getCell(status);
						
			System.out.println(celulaAtualCT.getStringCellValue());
		
				if (celulaAtualCT.getStringCellValue().equals("TEST_CASE_ID")) {
					
					System.out.println("status "+celulaAtualSTATUS.getStringCellValue());
					System.out.println("ct "+celulaAtualCT.getStringCellValue());	
					
					for (int i = 0; i < totalcolunas; i++) {
         				org.apache.poi.ss.usermodel.Cell celulaAtualCTs = row.getCell(i);
						org.apache.poi.ss.usermodel.Cell celulaAtualSTATUSs = row2.getCell(i);

						if (celulaAtualCTs.getStringCellValue().equals(TesteCaseId)) {
							celulaAtualSTATUSs.setCellValue(statusTest);
							FileOutputStream output = null;
							try {
								output = new FileOutputStream(new File((planilha)));
							} catch (FileNotFoundException e) {
								// TODO Auto-generated catch block
								e.printStackTrace();
							}
							try {
								workbook.write(output);
							} catch (IOException e) {
								// TODO Auto-generated catch block
								e.printStackTrace();
							}
							try {
								output.close();
							} catch (IOException e) {
								// TODO Auto-generated catch block
								e.printStackTrace();
							}
							return;

						}
					}
				}

			}
		}
		return;

	}
	

}
